FROM rust_libtorch
ENV LIBTORCH="/root/libtorch"
RUN rm -vf -- '/root/libtorch-shared-with-deps-2.9.0+cpu.zip'

RUN \
    echo 'Start rust analyzer install' \
        && curl -L 'https://github.com/rust-lang/rust-analyzer/releases/latest/download/rust-analyzer-x86_64-unknown-linux-gnu.gz' \
        | gunzip -c - \
        > '/usr/local/bin/rust-analyzer' \
        && chmod +x '/usr/local/bin/rust-analyzer' \
    && echo 'Done rust analyzer install' ;

USER root
RUN aria2c -c -x16 -j16 'https://github.com/helix-editor/helix/releases/download/25.07.1/helix-25.07.1-x86_64-linux.tar.xz'
RUN tar -xf ./helix-25.07.1-x86_64-linux.tar.xz
RUN \
    echo 'Start installing helix' \
        && cd ./helix-25.07.1-x86_64-linux/ \
        && mv hx /usr/local/bin \
        && mv runtime /usr/local/bin \
        && mv contrib/completion/hx.bash /usr/share/bash-completion/completions/hx \
        && mv ./contrib/completion/hx.zsh /usr/share/zsh/vendor-completions/_hx \
        && chown 'root:root' '/usr/share/zsh/vendor-completions/_hx' \
        && mv ./contrib/completion/hx.fish /usr/share/fish/completions/hx.fish \
    && echo 'Done installing helix' ;

RUN \
      --mount=target=/var/lib/apt/lists,type=cache,sharing=locked \
      --mount=target=/var/cache/apt,type=cache,sharing=locked \
      echo 'START apt-get stuff' \
      && apt-get -y update \
      && apt-get install -y \
          'neovim' \
      && echo 'DONE apt-get stuff' ;
